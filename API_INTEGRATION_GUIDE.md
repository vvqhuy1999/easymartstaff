# H∆Ø·ªöNG D·∫™N T√çCH H·ª¢P API V√ÄO D·ª∞ √ÅN VUE.JS

## üìã T·ªïng quan d·ª± √°n
- **Framework**: Vue.js 3 v·ªõi Composition API
- **Build tool**: Vite
- **Router**: Vue Router 4
- **HTTP Client**: Axios (ƒë√£ c√†i ƒë·∫∑t) + Fetch API (ƒëang s·ª≠ d·ª•ng)

## üöÄ Nh·ªØng th·ª© c·∫ßn thi·∫øt ƒë·ªÉ call API

### 1. **C·∫•u h√¨nh m√¥i tr∆∞·ªùng (Environment Configuration)**

#### 1.1 T·∫°o file `.env`
```bash
# .env
VITE_API_BASE_URL=http://localhost:8080/api
VITE_API_TIMEOUT=30000
VITE_API_VERSION=v1
```

#### 1.2 T·∫°o file `.env.production`
```bash
# .env.production
VITE_API_BASE_URL=https://your-production-domain.com/api
VITE_API_TIMEOUT=30000
VITE_API_VERSION=v1
```

#### 1.3 T·∫°o file `.env.development`
```bash
# .env.development
VITE_API_BASE_URL=http://localhost:8080/api
VITE_API_TIMEOUT=30000
VITE_API_VERSION=v1
```

### 2. **C√†i ƒë·∫∑t dependencies c·∫ßn thi·∫øt**

#### 2.1 C√†i ƒë·∫∑t th√™m packages
```bash
npm install axios interceptor-js
npm install --save-dev @types/node
```

#### 2.2 C√†i ƒë·∫∑t packages cho development
```bash
npm install --save-dev vite-plugin-env
```

### 3. **C·∫•u h√¨nh Vite (vite.config.js)**

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { loadEnv } from 'vite'

export default defineConfig(({ command, mode }) => {
  const env = loadEnv(mode, process.cwd(), '')
  
  return {
    plugins: [vue()],
    define: {
      __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
    },
    server: {
      port: 3000,
      proxy: {
        '/api': {
          target: env.VITE_API_BASE_URL || 'http://localhost:8080',
          changeOrigin: true,
          secure: false,
        }
      }
    },
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            vendor: ['vue', 'vue-router'],
            api: ['axios']
          }
        }
      }
    }
  }
})
```

### 4. **C·∫•u tr√∫c th∆∞ m·ª•c API**

```
src/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ axios.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints.js
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.service.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image.model.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.model.js
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ api.utils.js
‚îÇ       ‚îî‚îÄ‚îÄ error.handler.js
```

### 5. **C·∫•u h√¨nh Axios (src/api/config/axios.config.js)**

```javascript
import axios from 'axios'

// T·∫°o instance axios v·ªõi c·∫•u h√¨nh m·∫∑c ƒë·ªãnh
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api',
  timeout: import.meta.env.VITE_API_TIMEOUT || 30000,
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
  withCredentials: true, // N·∫øu c·∫ßn g·ª≠i cookies
})

// Request interceptor
apiClient.interceptors.request.use(
  (config) => {
    // Th√™m token v√†o header n·∫øu c√≥
    const token = localStorage.getItem('accessToken')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    // Th√™m timestamp ƒë·ªÉ tr√°nh cache
    if (config.method === 'get') {
      config.params = { ...config.params, _t: Date.now() }
    }
    
    console.log('API Request:', config.method?.toUpperCase(), config.url)
    return config
  },
  (error) => {
    console.error('Request Error:', error)
    return Promise.reject(error)
  }
)

// Response interceptor
apiClient.interceptors.response.use(
  (response) => {
    console.log('API Response:', response.status, response.config.url)
    return response
  },
  (error) => {
    console.error('Response Error:', error)
    
    // X·ª≠ l√Ω l·ªói 401 (Unauthorized)
    if (error.response?.status === 401) {
      localStorage.removeItem('accessToken')
      window.location.href = '/login'
    }
    
    // X·ª≠ l√Ω l·ªói 403 (Forbidden)
    if (error.response?.status === 403) {
      console.error('Access denied')
    }
    
    // X·ª≠ l√Ω l·ªói 500 (Internal Server Error)
    if (error.response?.status >= 500) {
      console.error('Server error')
    }
    
    return Promise.reject(error)
  }
)

export default apiClient
```

### 6. **ƒê·ªãnh nghƒ©a endpoints (src/api/config/endpoints.js)**

```javascript
export const API_ENDPOINTS = {
  // Authentication
  AUTH: {
    LOGIN: '/auth/login',
    REGISTER: '/auth/register',
    LOGOUT: '/auth/logout',
    REFRESH_TOKEN: '/auth/refresh-token',
    FORGOT_PASSWORD: '/auth/forgot-password',
    RESET_PASSWORD: '/auth/reset-password',
  },
  
  // Products
  PRODUCTS: {
    LIST: '/sanpham',
    DETAIL: (id) => `/sanpham/${id}`,
    CREATE: '/sanpham',
    UPDATE: (id) => `/sanpham/${id}`,
    DELETE: (id) => `/sanpham/${id}`,
    SEARCH: '/sanpham/search',
    CATEGORIES: '/sanpham/categories',
  },
  
  // Images
  IMAGES: {
    LIST: '/hinhanh',
    DETAIL: (id) => `/hinhanh/${id}`,
    CREATE: '/hinhanh',
    UPDATE: (id) => `/hinhanh/${id}`,
    DELETE: (id) => `/hinhanh/${id}`,
    BY_PRODUCT: (productId) => `/hinhanh/sanpham/${productId}`,
    UPLOAD: '/hinhanh/upload',
    SET_MAIN: (id) => `/hinhanh/${id}/set-main`,
  },
  
  // Users
  USERS: {
    LIST: '/nguoidung',
    DETAIL: (id) => `/nguoidung/${id}`,
    CREATE: '/nguoidung',
    UPDATE: (id) => `/nguoidung/${id}`,
    DELETE: (id) => `/nguoidung/${id}`,
    PROFILE: '/nguoidung/profile',
    CHANGE_PASSWORD: '/nguoidung/change-password',
  },
  
  // Categories
  CATEGORIES: {
    LIST: '/loaisanpham',
    DETAIL: (id) => `/loaisanpham/${id}`,
    CREATE: '/loaisanpham',
    UPDATE: (id) => `/loaisanpham/${id}`,
    DELETE: (id) => `/loaisanpham/${id}`,
  },
  
  // Orders
  ORDERS: {
    LIST: '/donhang',
    DETAIL: (id) => `/donhang/${id}`,
    CREATE: '/donhang',
    UPDATE: (id) => `/donhang/${id}`,
    DELETE: (id) => `/donhang/${id}`,
    BY_USER: (userId) => `/donhang/nguoidung/${userId}`,
    UPDATE_STATUS: (id) => `/donhang/${id}/status`,
  }
}
```

### 7. **Service layer (src/api/services/product.service.js)**

```javascript
import apiClient from '../config/axios.config.js'
import { API_ENDPOINTS } from '../config/endpoints.js'

export class ProductService {
  // L·∫•y danh s√°ch s·∫£n ph·∫©m
  static async getProducts(params = {}) {
    try {
      const response = await apiClient.get(API_ENDPOINTS.PRODUCTS.LIST, { params })
      return response.data
    } catch (error) {
      console.error('Error fetching products:', error)
      throw error
    }
  }
  
  // L·∫•y chi ti·∫øt s·∫£n ph·∫©m
  static async getProductById(id) {
    try {
      const response = await apiClient.get(API_ENDPOINTS.PRODUCTS.DETAIL(id))
      return response.data
    } catch (error) {
      console.error('Error fetching product:', error)
      throw error
    }
  }
  
  // T·∫°o s·∫£n ph·∫©m m·ªõi
  static async createProduct(productData) {
    try {
      const response = await apiClient.post(API_ENDPOINTS.PRODUCTS.CREATE, productData)
      return response.data
    } catch (error) {
      console.error('Error creating product:', error)
      throw error
    }
  }
  
  // C·∫≠p nh·∫≠t s·∫£n ph·∫©m
  static async updateProduct(id, productData) {
    try {
      const response = await apiClient.put(API_ENDPOINTS.PRODUCTS.UPDATE(id), productData)
      return response.data
    } catch (error) {
      console.error('Error updating product:', error)
      throw error
    }
  }
  
  // X√≥a s·∫£n ph·∫©m
  static async deleteProduct(id) {
    try {
      const response = await apiClient.delete(API_ENDPOINTS.PRODUCTS.DELETE(id))
      return response.data
    } catch (error) {
      console.error('Error deleting product:', error)
      throw error
    }
  }
  
  // T√¨m ki·∫øm s·∫£n ph·∫©m
  static async searchProducts(query, filters = {}) {
    try {
      const params = { q: query, ...filters }
      const response = await apiClient.get(API_ENDPOINTS.PRODUCTS.SEARCH, { params })
      return response.data
    } catch (error) {
      console.error('Error searching products:', error)
      throw error
    }
  }
  
  // L·∫•y danh m·ª•c s·∫£n ph·∫©m
  static async getCategories() {
    try {
      const response = await apiClient.get(API_ENDPOINTS.PRODUCTS.CATEGORIES)
      return response.data
    } catch (error) {
      console.error('Error fetching categories:', error)
      throw error
    }
  }
}

export default ProductService
```

### 8. **Error handling (src/api/utils/error.handler.js)**

```javascript
export class ApiError extends Error {
  constructor(message, status, code, details = null) {
    super(message)
    this.name = 'ApiError'
    this.status = status
    this.code = code
    this.details = details
    this.timestamp = new Date()
  }
}

export const handleApiError = (error) => {
  if (error.response) {
    // Server tr·∫£ v·ªÅ response v·ªõi status code l·ªói
    const { status, data } = error.response
    
    switch (status) {
      case 400:
        return new ApiError('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá', status, 'BAD_REQUEST', data)
      case 401:
        return new ApiError('Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p', status, 'UNAUTHORIZED', data)
      case 403:
        return new ApiError('B·ªã t·ª´ ch·ªëi truy c·∫≠p', status, 'FORBIDDEN', data)
      case 404:
        return new ApiError('Kh√¥ng t√¨m th·∫•y t√†i nguy√™n', status, 'NOT_FOUND', data)
      case 409:
        return new ApiError('Xung ƒë·ªôt d·ªØ li·ªáu', status, 'CONFLICT', data)
      case 422:
        return new ApiError('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá', status, 'UNPROCESSABLE_ENTITY', data)
      case 500:
        return new ApiError('L·ªói server', status, 'INTERNAL_SERVER_ERROR', data)
      case 502:
        return new ApiError('L·ªói gateway', status, 'BAD_GATEWAY', data)
      case 503:
        return new ApiError('D·ªãch v·ª• kh√¥ng kh·∫£ d·ª•ng', status, 'SERVICE_UNAVAILABLE', data)
      default:
        return new ApiError('L·ªói kh√¥ng x√°c ƒë·ªãnh', status, 'UNKNOWN_ERROR', data)
    }
  } else if (error.request) {
    // Request ƒë∆∞·ª£c g·ª≠i nh∆∞ng kh√¥ng nh·∫≠n ƒë∆∞·ª£c response
    return new ApiError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server', 0, 'NETWORK_ERROR')
  } else {
    // L·ªói kh√°c
    return new ApiError(error.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh', 0, 'UNKNOWN_ERROR')
  }
}

export const showErrorMessage = (error) => {
  if (error instanceof ApiError) {
    // Hi·ªÉn th·ªã l·ªói API
    console.error(`API Error [${error.code}]: ${error.message}`)
    // C√≥ th·ªÉ hi·ªÉn th·ªã toast notification ·ªü ƒë√¢y
    return error.message
  } else {
    // Hi·ªÉn th·ªã l·ªói kh√°c
    console.error('Unexpected error:', error)
    return 'ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh'
  }
}
```

### 9. **S·ª≠ d·ª•ng trong component Vue**

```vue
<template>
  <div class="product-list">
    <div v-if="loading" class="loading">ƒêang t·∫£i...</div>
    <div v-else-if="error" class="error">{{ error }}</div>
    <div v-else>
      <div v-for="product in products" :key="product.maSP">
        {{ product.tenSP }}
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import ProductService from '@/api/services/product.service.js'
import { handleApiError, showErrorMessage } from '@/api/utils/error.handler.js'

const products = ref([])
const loading = ref(false)
const error = ref(null)

const fetchProducts = async () => {
  try {
    loading.value = true
    error.value = null
    
    const data = await ProductService.getProducts({
      page: 1,
      limit: 20,
      sortBy: 'tenSP',
      sortOrder: 'asc'
    })
    
    products.value = data.items || data
  } catch (err) {
    const apiError = handleApiError(err)
    error.value = showErrorMessage(apiError)
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchProducts()
})
</script>
```

### 10. **C·∫•u h√¨nh CORS (Backend)**

N·∫øu b·∫°n ƒëang ph√°t tri·ªÉn backend, c·∫ßn c·∫•u h√¨nh CORS:

```javascript
// Node.js/Express
app.use(cors({
  origin: ['http://localhost:3000', 'http://localhost:5173'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}))

// Spring Boot
@CrossOrigin(origins = {"http://localhost:3000", "http://localhost:5173"}, 
             allowCredentials = "true")
```

### 11. **Testing API**

#### 11.1 S·ª≠ d·ª•ng Postman/Insomnia
- Test c√°c endpoint
- Ki·ªÉm tra response format
- Test error handling

#### 11.2 S·ª≠ d·ª•ng console
```javascript
// Trong browser console
import ProductService from './src/api/services/product.service.js'
ProductService.getProducts().then(console.log).catch(console.error)
```

### 12. **Monitoring v√† Logging**

```javascript
// Th√™m v√†o axios config
apiClient.interceptors.request.use((config) => {
  console.log(`üöÄ ${config.method?.toUpperCase()} ${config.url}`)
  return config
})

apiClient.interceptors.response.use(
  (response) => {
    console.log(`‚úÖ ${response.status} ${response.config.url}`)
    return response
  },
  (error) => {
    console.error(`‚ùå ${error.response?.status || 'NETWORK'} ${error.config?.url || 'Unknown'}`)
    return Promise.reject(error)
  }
)
```

## üîß Checklist tri·ªÉn khai

- [ ] T·∫°o file m√¥i tr∆∞·ªùng (.env)
- [ ] C√†i ƒë·∫∑t dependencies
- [ ] C·∫•u h√¨nh Vite
- [ ] T·∫°o c·∫•u tr√∫c th∆∞ m·ª•c API
- [ ] C·∫•u h√¨nh Axios v√† interceptors
- [ ] ƒê·ªãnh nghƒ©a endpoints
- [ ] T·∫°o service layer
- [ ] Implement error handling
- [ ] Test API endpoints
- [ ] C·∫•u h√¨nh CORS (backend)
- [ ] Monitoring v√† logging

## üìö T√†i li·ªáu tham kh·∫£o

- [Vue.js 3 Documentation](https://vuejs.org/)
- [Axios Documentation](https://axios-http.com/)
- [Vite Configuration](https://vitejs.dev/config/)
- [REST API Best Practices](https://restfulapi.net/)
- [HTTP Status Codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

## üÜò H·ªó tr·ª£

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ trong qu√° tr√¨nh t√≠ch h·ª£p API, h√£y ki·ªÉm tra:
1. Console browser ƒë·ªÉ xem l·ªói
2. Network tab ƒë·ªÉ ki·ªÉm tra request/response
3. Backend logs
4. CORS configuration
5. Environment variables
